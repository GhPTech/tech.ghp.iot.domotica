# TECH GHP IOT DOMOTICA API

${Bundle-Description}

##API Project

An Application Programming Interface (API) is recommended in order to separate interface code from implementation code. The API  is like a service contract. The best practice is to give service contracts their own projects so they can be easily shared. For API projects, the sufix of the name should be *.api*. OSGi enRoute recognises this suffix and will select the appropriate layout for the API project.

To create the API project, from the main menu select

*File/New/Bndtools Project*

select the *OSGi enRoute* template and give the following name:

*tech.ghp.iot.domotica.api*

The *OSGI enRoute* template creates a project with all the options set to treat it as an API. The templates creates the *Domotica* interface in the right package. The *Domotica* class should specify that the *Domotica* interface converts an input string to upper case as follows:

     package tech.ghp.iot.domotica.api;
	
	 import org.osgi.annotation.versioning.ProviderType;

	 /**
 	 * A service that turns a string to uppercase
 	 */
	 @ProviderType
	 public interface Domotica {
	 	/**
	 	* Turn a string into upper case
	 	*/
	
	 	String upper(String input);
	}

In the *generated* folder of the project, the file *tech.ghp.iot.domotica.api.jar* is created. This file contains the *Manifest*, which was generated by *bnd*. 
The *Manifest* shows that the package *tech.ghp.iot.domotica.api* is exported. This means that this package is available for other bundles. The *Contents* tab of the *bnd.bnd* file shows the *Export packages* list.  

![tech.ghp.iot.domotica.api](http://enroute.osgi.org/img/tutorial_base/project-create-5.png "The box with rounded corners represents a bundle; the inside black box represents an exported package. The package 'tech.ghp.upper.api' is exported and made available to other bundles. ")

The *version* of this package is defined in the file *package-info.java*. 

    @org.osgi.annotation.versioning.Version("1.0.0")
    package tech.ghp.iot.domotica.api;

The modifications of this package should be reflected in the specified version. Any modification that affects the public API must result in a rebuild of the bundle of the *provider*(the party that implements the *Domotica* interface). For example, if the version goes to *1.1*, the bundels that implemented *1.0* should no longer be compatible. In order to assure that the proper version ranges are used, the following annotation should be added:

    @ProviderType
    public interface Domotica { ... }
    
By making this annotation, the *bndtool* will automatically ensure that the *providers/implementers* of the respective interface  use semantic versioning to import the package with a minor range, *1.0, 1.0*.

The default implemented interfaces of the API (usually listener like interfaces) are *consumer* type and could be annotated as

    @ConsumerType
    
The *bnd* project is driven by the *bnd.bnd* file, which defines the *version*, the *build path* and which packages should go into the bundle. For example, the source of the *bnd.bnd* file is as follows:

    Bundle-Version:1.0.0.${tstamp}
    Bundle-Description: 				\
	    This is  project. An API project should in general not contain any \
	    implementation code.\
	    \
	    ${warning;Please update this Bundle-Description in tech.ghp.iot.domotica.api/bnd.bnd}

     Export-Package:  \
	     tech.ghp.iot.domotica.api;provide:=true


     Require-Capability: \
	     compile-only

    -buildpath: \
	     osgi.enroute.base.api;version=1.0

    -testpath: \
	    osgi.enroute.junit.wrapper;version=4.12

## Example

## References